<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"reporters_SignalFxMetricsReporter.js.html":{"id":"reporters_SignalFxMetricsReporter.js.html","title":"Source: reporters/SignalFxMetricsReporter.js","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global Source: reporters/SignalFxMetricsReporter.js const { Reporter } = require('measured-reporting'); const { MetricTypes } = require('measured-core'); const { validateSignalFxClient } = require('../validators/inputValidators'); /** * A Reporter that reports metrics to Signal Fx * @extends {Reporter} */ class SignalFxMetricsReporter extends Reporter { /** * @param {SignalFxClient} signalFxClient The configured signal fx client. * @param {ReporterOptions} [options] See {@link ReporterOptions}. */ constructor(signalFxClient, options) { super(options); validateSignalFxClient(signalFxClient); this._signalFxClient = signalFxClient; } /** * Sends metrics to signal fx, converting name and dimensions and {@link Metric} to data signal fx can ingest * @param {MetricWrapper[]} metrics The array of metrics to send to signal fx. * @protected */ _reportMetrics(metrics) { this._log.debug('_reportMetrics() called'); let signalFxDataPointRequest = {}; metrics.forEach(metric =&gt; { if (!metric) { this._log.warn('Metric was null when it should not have been'); return; } signalFxDataPointRequest = this._processMetric(metric, signalFxDataPointRequest); }); this._log.debug('Sending data to Signal Fx'); this._signalFxClient.send(signalFxDataPointRequest).catch(error =&gt; { this._log.error('Failed to send metrics to signal fx error:', error); }); } /** * Method for getting raw signal fx api request values from the Timer Object. * * @param {MetricWrapper} metric metric The Wrapped Metric Object. * @param {any} currentBuiltRequest The signal fx request that is being built. * @return {any} the currentBuiltRequest The signal fx request that is being built with the given metric in it. * @protected */ _processMetric(metric, currentBuiltRequest) { const newRequest = Object.assign({}, currentBuiltRequest); const { name, metricImpl } = metric; const mergedDimensions = this._getDimensions(metric); const valuesToProcess = this._getValuesToProcessForType(name, metricImpl); valuesToProcess.forEach(metricValueTypeWrapper =&gt; { const signalFxDataPointMetric = { metric: metricValueTypeWrapper.metric, value: metricValueTypeWrapper.value, dimensions: mergedDimensions }; if (Object.prototype.hasOwnProperty.call(newRequest, metricValueTypeWrapper.type)) { newRequest[metricValueTypeWrapper.type].push(signalFxDataPointMetric); } else { newRequest[metricValueTypeWrapper.type] = [signalFxDataPointMetric]; } }); return newRequest; } /** * Maps Measured Metrics Object JSON outputs to there respective signal fx metrics using logic from * com.signalfx.codahale.reporter.AggregateMetricSenderSessionWrapper in the java lib to derive naming * * @param {string} name The registered metric base name * @param {Metric} metric The metric. * @return {MetricValueTypeWrapper[]} an array of MetricValueTypeWrapper that can be used to * build the sig fx data point request * @protected */ _getValuesToProcessForType(name, metric) { const type = metric.getType(); switch (type) { case MetricTypes.TIMER: return this._getValuesToProcessForTimer(name, metric); case MetricTypes.GAUGE: return this._getValuesToProcessForGauge(name, metric); case MetricTypes.COUNTER: return this._getValuesToProcessForCounter(name, metric); case MetricTypes.HISTOGRAM: return this._getValuesToProcessForHistogram(name, metric); case MetricTypes.METER: this._log.warn( 'Meters are not implemented in the signal fx reporter as you can use a counter and reduce your DPM' ); return []; default: this._log.error(`Metric Type: ${type} has not been implemented to report to signal fx`); return []; } } /** * Maps and Filters values from a Timer to a set of metrics to report to SigFx. * * @param {string} name The registry name * @param {Timer} timer The Timer * @return {MetricValueTypeWrapper[]} Returns an array of MetricValueTypeWrapper to use to build the request * @protected */ _getValuesToProcessForTimer(name, timer) { let valuesToProcess = []; // only grab histogram data as Meters can be accomplished with signal fx using the count from the histogram valuesToProcess = valuesToProcess.concat(this._getValuesToProcessForHistogram(name, timer._histogram)); return valuesToProcess; } /** * Maps and Filters values from a Gauge to a set of metrics to report to SigFx. * * @param {string} name The registry name * @param {Gauge} gauge The Gauge * @return {MetricValueTypeWrapper[]} Returns an array of MetricValueTypeWrapper to use to build the request * @protected */ _getValuesToProcessForGauge(name, gauge) { const valuesToProcess = []; valuesToProcess.push({ metric: `${name}`, value: gauge.toJSON(), type: SIGNAL_FX_GAUGE }); return valuesToProcess; } /** * Maps and Filters values from a Counter to a set of metrics to report to SigFx. * * @param {string} name The registry name * @param {Counter} counter The data from the measure metric object * @return {MetricValueTypeWrapper[]} Returns an array of MetricValueTypeWrapper to use to build the request * @protected */ _getValuesToProcessForCounter(name, counter) { const valuesToProcess = []; valuesToProcess.push({ metric: `${name}.count`, value: counter.toJSON(), type: SIGNAL_FX_CUMULATIVE_COUNTER }); return valuesToProcess; } /** * Maps and Filters values from a Histogram to a set of metrics to report to SigFx. * * @param {string} name The registry name * @param {Histogram} histogram The Histogram * @return {MetricValueTypeWrapper[]} Returns an array of MetricValueTypeWrapper to use to build the request * @protected */ _getValuesToProcessForHistogram(name, histogram) { // TODO add full list of histogram metrics but enable filter const data = histogram.toJSON(); const valuesToProcess = []; valuesToProcess.push({ metric: `${name}.count`, value: data.count || 0, type: SIGNAL_FX_CUMULATIVE_COUNTER }); valuesToProcess.push({ metric: `${name}.max`, value: data.max || 0, type: SIGNAL_FX_GAUGE }); valuesToProcess.push({ metric: `${name}.min`, value: data.min || 0, type: SIGNAL_FX_GAUGE }); valuesToProcess.push({ metric: `${name}.mean`, value: data.mean || 0, type: SIGNAL_FX_GAUGE }); valuesToProcess.push({ metric: `${name}.p95`, value: data.p95 || 0, type: SIGNAL_FX_GAUGE }); valuesToProcess.push({ metric: `${name}.p99`, value: data.p99 || 0, type: SIGNAL_FX_GAUGE }); return valuesToProcess; } } // const SIGNAL_FX_COUNTER = 'counters'; const SIGNAL_FX_GAUGE = 'gauges'; const SIGNAL_FX_CUMULATIVE_COUNTER = 'cumulative_counters'; module.exports = SignalFxMetricsReporter; /** * Wrapper object to wrap metric value and SFX metadata needed to send metric value to SFX data ingestion. * * @interface MetricValueTypeWrapper * @typedef MetricValueTypeWrapper * @type {Object} * @property {string} metric The metric name to report to SignalFx * @property {number} value the value to report to SignalFx * @property {string} type The mapped SignalFx metric type */ × Search results Close "},"index.js.html":{"id":"index.js.html","title":"Source: index.js","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global Source: index.js const SignalFxMetricsReporter = require('./reporters/SignalFxMetricsReporter'); const SignalFxSelfReportingMetricsRegistry = require('./registries/SignalFxSelfReportingMetricsRegistry'); /** * The main measured module that is referenced when require('measured-signalfx-reporter') is used. * @module measured-signalfx-reporter */ module.exports = { /** * {@type SignalFxMetricsReporter} */ SignalFxMetricsReporter, /** * {@type SignalFxSelfReportingMetricsRegistry} */ SignalFxSelfReportingMetricsRegistry }; × Search results Close "},"validators_inputValidators.js.html":{"id":"validators_inputValidators.js.html","title":"Source: validators/inputValidators.js","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global Source: validators/inputValidators.js /** * Validation functions for validating public input * @module SignalFxReporterInputValidators * @private */ module.exports = { /** * Validates that the object supplied for the sfx client at least has a send function * @param signalFxClient */ validateSignalFxClient: signalFxClient =&gt; { if (signalFxClient === undefined) { throw new Error('signalFxClient was undefined when it is required'); } if (typeof signalFxClient.send !== 'function' || signalFxClient.length &lt; 1) { throw new Error('signalFxClient must implement send(data: any)'); } } }; × Search results Close "},"registries_SignalFxSelfReportingMetricsRegistry.js.html":{"id":"registries_SignalFxSelfReportingMetricsRegistry.js.html","title":"Source: registries/SignalFxSelfReportingMetricsRegistry.js","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global Source: registries/SignalFxSelfReportingMetricsRegistry.js const { NoOpMeter, Timer } = require('measured-core'); const { SelfReportingMetricsRegistry } = require('measured-reporting'); const { validateTimerOptions } = require('measured-reporting').inputValidators; /** * A SignalFx Self Reporting Metrics Registry that disallows the use of meters as they waste DPM and accomplished using a counter. * @extends {SelfReportingMetricsRegistry} */ class SignalFxSelfReportingMetricsRegistry extends SelfReportingMetricsRegistry { /** * Creates a {@link Timer} or get the existing Timer for a given name and dimension combo with a NoOpMeter * * @param {string} name The Metric name * @param {Dimensions} dimensions any custom {@link Dimensions} for the Metric * @param {number} publishingIntervalInSeconds a optional custom publishing interval * @return {Timer} */ getOrCreateTimer(name, dimensions, publishingIntervalInSeconds) { validateTimerOptions(name, dimensions, publishingIntervalInSeconds); let timer; if (this._registry.hasMetric(name, dimensions)) { timer = this._registry.getMetric(name, dimensions); } else { timer = new Timer({ meter: new NoOpMeter() }); const key = this._registry.putMetric(name, timer, dimensions); this._reporter.reportMetricOnInterval(key, publishingIntervalInSeconds); } return timer; } /** * You should use counters and implements meter functionality in your Dashboard. * @param {string} name The Metric name * @param {Dimensions} dimensions any custom {@link Dimensions} for the Metric * @param {number} publishingIntervalInSeconds a optional custom publishing interval * @return {NoOpMeter|*} */ getOrCreateMeter(name, dimensions, publishingIntervalInSeconds) { this._log.error( 'Meters will not get reported using the SignalFx reporter as they waste DPM, please use a counter instead' ); return new NoOpMeter(); } } module.exports = SignalFxSelfReportingMetricsRegistry; × Search results Close "},"global.html":{"id":"global.html","title":"Global","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global Global Type Definitions MetricValueTypeWrapper Wrapper object to wrap metric value and SFX metadata needed to send metric value to SFX data ingestion. Type: Object Properties: Name Type Description metric string The metric name to report to SignalFx value number the value to report to SignalFx type string The mapped SignalFx metric type Source: reporters/SignalFxMetricsReporter.js, line 213 × Search results Close "},"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global Modules Classes SignalFxMetricsReporter SignalFxSelfReportingMetricsRegistry × Search results Close "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global Classes Classes SignalFxMetricsReporter SignalFxSelfReportingMetricsRegistry × Search results Close "},"tutorials.list.html":{"id":"tutorials.list.html","title":"Tutorials","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global Tutorials Classes SignalFxMetricsReporter SignalFxSelfReportingMetricsRegistry × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global Measured SignalFx ReporterThis package ties together measured-core and measured-reporting to create a dimensional aware self reporting metrics registry that reports metrics to SignalFx. Installnpm install measured-signalfx-reporterWhat is in this packageSignalFxMetricsReporterA SignalFx specific implementation of the Reporter Abstract Class. Please note that this implementation ignores Meters and is opinionated that you should do meter logic with counters and utilize the built in capabilities of SignalFx to get rates from counted events. This lowers your DPM usage and is how SignalFx charges you, thus lowering your bill. If presented with a valid argument, I am open to changing this. SignalFxSelfReportingMetricsRegistryExtends Self Reporting Metrics Registry but overrides methods that generate Meters to use the NoOpMeter. Again this is opinionated that you shouldn't use Meters with SignalFx, because you can use a counter and get the same results at 1/6 the DPM usage. If presented with a valid argument, I am open to changing this. UsageSee the full end to end example here: SignalFx Express Full End to End Example DevThere is a user acceptance test server to test this library end to end to signalfx SIGNALFX_API_KEY=xxxxx yarn uat:server × Search results Close "},"module-measured-signalfx-reporter.html":{"id":"module-measured-signalfx-reporter.html","title":"Module: measured-signalfx-reporter","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global Module: measured-signalfx-reporter The main measured module that is referenced when require('measured-signalfx-reporter') is used. Source: index.js, line 4 Members &lt;static&gt; SignalFxMetricsReporter {@type SignalFxMetricsReporter} Source: index.js, line 12 &lt;static&gt; SignalFxSelfReportingMetricsRegistry {@type SignalFxSelfReportingMetricsRegistry} Source: index.js, line 16 × Search results Close "},"SignalFxMetricsReporter.html":{"id":"SignalFxMetricsReporter.html","title":"Class: SignalFxMetricsReporter","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global Class: SignalFxMetricsReporter SignalFxMetricsReporter A Reporter that reports metrics to Signal Fx new SignalFxMetricsReporter(signalFxClient [, options]) Parameters: Name Type Argument Description signalFxClient SignalFxClient The configured signal fx client. options ReporterOptions &lt;optional&gt; See ReporterOptions. Source: reporters/SignalFxMetricsReporter.js, line 9 Extends Reporter Methods &lt;protected&gt; _getValuesToProcessForCounter(name, counter) Maps and Filters values from a Counter to a set of metrics to report to SigFx. Parameters: Name Type Description name string The registry name counter Counter The data from the measure metric object Source: reporters/SignalFxMetricsReporter.js, line 151 Returns: Returns an array of MetricValueTypeWrapper to use to build the request Type Array.&lt;MetricValueTypeWrapper&gt; &lt;protected&gt; _getValuesToProcessForGauge(name, gauge) Maps and Filters values from a Gauge to a set of metrics to report to SigFx. Parameters: Name Type Description name string The registry name gauge Gauge The Gauge Source: reporters/SignalFxMetricsReporter.js, line 133 Returns: Returns an array of MetricValueTypeWrapper to use to build the request Type Array.&lt;MetricValueTypeWrapper&gt; &lt;protected&gt; _getValuesToProcessForHistogram(name, histogram) Maps and Filters values from a Histogram to a set of metrics to report to SigFx. Parameters: Name Type Description name string The registry name histogram Histogram The Histogram Source: reporters/SignalFxMetricsReporter.js, line 169 Returns: Returns an array of MetricValueTypeWrapper to use to build the request Type Array.&lt;MetricValueTypeWrapper&gt; &lt;protected&gt; _getValuesToProcessForTimer(name, timer) Maps and Filters values from a Timer to a set of metrics to report to SigFx. Parameters: Name Type Description name string The registry name timer Timer The Timer Source: reporters/SignalFxMetricsReporter.js, line 118 Returns: Returns an array of MetricValueTypeWrapper to use to build the request Type Array.&lt;MetricValueTypeWrapper&gt; &lt;protected&gt; _getValuesToProcessForType(name, metric) Maps Measured Metrics Object JSON outputs to there respective signal fx metrics using logic fromcom.signalfx.codahale.reporter.AggregateMetricSenderSessionWrapper in the java lib to derive naming Parameters: Name Type Description name string The registered metric base name metric Metric The metric. Source: reporters/SignalFxMetricsReporter.js, line 88 Returns: an array of MetricValueTypeWrapper that can be used tobuild the sig fx data point request Type Array.&lt;MetricValueTypeWrapper&gt; &lt;protected&gt; _processMetric(metric, currentBuiltRequest) Method for getting raw signal fx api request values from the Timer Object. Parameters: Name Type Description metric MetricWrapper metric The Wrapped Metric Object. currentBuiltRequest any The signal fx request that is being built. Source: reporters/SignalFxMetricsReporter.js, line 53 Returns: the currentBuiltRequest The signal fx request that is being built with the given metric in it. Type any &lt;protected&gt; _reportMetrics(metrics) Sends metrics to signal fx, converting name and dimensions and Metric to data signal fx can ingest Parameters: Name Type Description metrics Array.&lt;MetricWrapper&gt; The array of metrics to send to signal fx. Source: reporters/SignalFxMetricsReporter.js, line 25 × Search results Close "},"SignalFxSelfReportingMetricsRegistry.html":{"id":"SignalFxSelfReportingMetricsRegistry.html","title":"Class: SignalFxSelfReportingMetricsRegistry","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global Class: SignalFxSelfReportingMetricsRegistry SignalFxSelfReportingMetricsRegistry A SignalFx Self Reporting Metrics Registry that disallows the use of meters as they waste DPM and accomplished using a counter. new SignalFxSelfReportingMetricsRegistry() Source: registries/SignalFxSelfReportingMetricsRegistry.js, line 9 Extends SelfReportingMetricsRegistry Methods getOrCreateMeter(name, dimensions, publishingIntervalInSeconds) You should use counters and implements meter functionality in your Dashboard. Parameters: Name Type Description name string The Metric name dimensions Dimensions any custom Dimensions for the Metric publishingIntervalInSeconds number a optional custom publishing interval Source: registries/SignalFxSelfReportingMetricsRegistry.js, line 40 Returns: Type NoOpMeter | * getOrCreateTimer(name, dimensions, publishingIntervalInSeconds) Creates a Timer or get the existing Timer for a given name and dimension combo with a NoOpMeter Parameters: Name Type Description name string The Metric name dimensions Dimensions any custom Dimensions for the Metric publishingIntervalInSeconds number a optional custom publishing interval Source: registries/SignalFxSelfReportingMetricsRegistry.js, line 18 Returns: Type Timer × Search results Close "},"tutorial-SignalFx Express Full End to End Example.html":{"id":"tutorial-SignalFx Express Full End to End Example.html","title":"Tutorial: SignalFx Express Full End to End Example","body":" Measured Modules measured-signalfx-reporter Classes SignalFxMetricsReporterSignalFxSelfReportingMetricsRegistry Tutorials SignalFx Express Full End to End Example Global Global SignalFx Express Full End to End Example Using Measured to instrument OS, Process and Express Metrics.This tutorial shows how to use the measured libraries to fully instrument OS and Node Process metrics as well as create an express middleware. The middleware will measure request count, latency distributions (req/res time histogram) and add dimensions to make it filterable by request method, response status code, request uri path. const os = require('os'); const signalfx = require('signalfx'); const express = require('express'); const { SignalFxMetricsReporter, SignalFxSelfReportingMetricsRegistry } = require('measured-signalfx-reporter'); const { Stopwatch } = require('measured-core'); const libraryMetadata = require('./package'); // get metadata from package.json const library = libraryMetadata.name; const version = libraryMetadata.version; // Report process and os stats 1x per minute const PROCESS_AND_SYSTEM_METRICS_REPORTING_INTERVAL_IN_SECONDS = 60; // Report the request count and histogram stats every 10 seconds const REQUEST_METRICS_REPORTING_INTERVAL_IN_SECONDS = 10; const defaultDimensions = { app: library, app_version: version, env: 'test' }; /** * Get your api key from a secrets provider of some kind. * * Good examples: * * &lt;li&gt; S3 with KMS * &lt;li&gt; Cerberus * &lt;li&gt; AWS Secrets Manager * &lt;li&gt; Vault * &lt;li&gt; Confidant * * Bad examples: * * &lt;li&gt; Checked into SCM in plaintext as a property * &lt;li&gt; Set as a plaintext environment variable * * @return {string} Returns the resolved Signal Fx Api Key */ const apiKeyResolver = () =&gt; { // https://diogomonica.com/2017/03/27/why-you-shouldnt-use-env-variables-for-secret-data/ return process.env.SIGNALFX_API_KEY; }; // Create the signal fx client const signalFxClient = new signalfx.Ingest(apiKeyResolver(), { userAgents: library }); // Create the signal fx reporter with the client const signalFxReporter = new SignalFxMetricsReporter(signalFxClient, { defaultDimensions: defaultDimensions, defaultReportingIntervalInSeconds: 10, logLevel: 'debug' }); // Create the self reporting metrics registry with the signal fx reporter const metricsRegistry = new SignalFxSelfReportingMetricsRegistry(signalFxReporter, { logLevel: 'debug' }); // Create a gauge to track the 1 minute load average from the Node OS API. metricsRegistry.getOrCreateGauge( 'os-1m-load-average', () =&gt; { // os.loadavg returns an array [1, 5, 15] mins intervals return os.loadavg()[0]; }, {}, PROCESS_AND_SYSTEM_METRICS_REPORTING_INTERVAL_IN_SECONDS ); // Create a gauge to track the amount of free memory for the system from the Node OS API. metricsRegistry.getOrCreateGauge( 'os-free-mem-bytes', () =&gt; { return os.freemem(); }, {}, PROCESS_AND_SYSTEM_METRICS_REPORTING_INTERVAL_IN_SECONDS ); // Create a gauge to track the amount of memory used for the system from the Node OS API. metricsRegistry.getOrCreateGauge( 'os-total-mem-bytes', () =&gt; { return os.totalmem(); }, {}, PROCESS_AND_SYSTEM_METRICS_REPORTING_INTERVAL_IN_SECONDS ); // https://nodejs.org/api/process.html#process_process_memoryusage metricsRegistry.getOrCreateGauge( 'process-memory-rss', () =&gt; { return process.memoryUsage().rss; }, {}, PROCESS_AND_SYSTEM_METRICS_REPORTING_INTERVAL_IN_SECONDS ); // https://nodejs.org/api/process.html#process_process_memoryusage metricsRegistry.getOrCreateGauge( 'process-memory-heap-total', () =&gt; { return process.memoryUsage().heapTotal; }, {}, PROCESS_AND_SYSTEM_METRICS_REPORTING_INTERVAL_IN_SECONDS ); // https://nodejs.org/api/process.html#process_process_memoryusage metricsRegistry.getOrCreateGauge( 'process-memory-heap-used', () =&gt; { return process.memoryUsage().heapUsed; }, {}, PROCESS_AND_SYSTEM_METRICS_REPORTING_INTERVAL_IN_SECONDS ); // https://nodejs.org/api/process.html#process_process_memoryusage metricsRegistry.getOrCreateGauge( 'process-memory-external', () =&gt; { const mem = process.memoryUsage(); return mem.hasOwnProperty('external') ? mem.external : 0; }, {}, PROCESS_AND_SYSTEM_METRICS_REPORTING_INTERVAL_IN_SECONDS ); // https://nodejs.org/api/process.html#process_process_uptime metricsRegistry.getOrCreateGauge( 'process-uptime-seconds', () =&gt; { return Math.floor(process.uptime()); }, {}, PROCESS_AND_SYSTEM_METRICS_REPORTING_INTERVAL_IN_SECONDS ); // Now that we have some base system and process metrics wired up, // lets wire up an express middleware that will track request count, latency statics and give us all this // information filterable by http method, response status code and URI path. /** * This middleware is a little interesting because we need to track the time elapsed before we know the status code dimension. * So we will create the Stopwatch manually rather that using the API available on the Timer object itself, see api docs for more info. * * @param metricsRegistry the self reporting metrics registry * @return {Function} Express Middleware */ const createExpressMiddleware = metricsRegistry =&gt; { return (req, res, next) =&gt; { const stopwatch = new Stopwatch(); req.on('end', () =&gt; { const customDimensions = { statusCode: `${res.statusCode}`, path: req.route ? req.route.path : '_unknown', method: req.method }; // create the timer for the request count/latency histogram const requestTimer = metricsRegistry.getOrCreateTimer( 'request', customDimensions, REQUEST_METRICS_REPORTING_INTERVAL_IN_SECONDS ); // stop the request latency counter const time = stopwatch.end(); requestTimer.update(time); }); next(); }; }; const app = express(); // wire up the metrics middleware app.use(createExpressMiddleware(metricsRegistry)); app.get('/hello', (req, res) =&gt; { res.send('hello world'); }); app.get('/path2', (req, res) =&gt; { res.send('path2'); }); app.listen(8080, () =&gt; log.info('Example app listening on port 8080!')); × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
